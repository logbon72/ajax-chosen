(function(){(function($){return $.fn.ajaxChosen=function(h,j,k){var l,defaultOptions,options,select;if(h==null){h={}}if(k==null){k={}}defaultOptions={minTermLength:3,afterTypeDelay:500,jsonTermKey:"term",keepTypingMsg:"Keep typing...",lookingForMsg:"Looking for"};select=this;l=null;options=$.extend({},defaultOptions,$(select).data(),h);this.chosen(k?k:{});return this.each(function(){return $(this).next('.chosen-container').find(".search-field > input, .chosen-search > input").bind('keyup',function(){var g,msg,success,untrimmed_val,val;untrimmed_val=$(this).val();val=$.trim($(this).val());msg=val.length<options.minTermLength?options.keepTypingMsg:options.lookingForMsg+(" '"+val+"'");select.next('.chosen-container').find('.no-results').text(msg);if(val===$(this).data('prevVal')){return false}$(this).data('prevVal',val);if(this.timer){clearTimeout(this.timer)}if(val.length<options.minTermLength){return false}g=$(this);if(options.data==null){options.data={}}options.data[options.jsonTermKey]=val;if(options.dataCallback!=null){options.data=options.dataCallback(options.data)}success=options.success;options.success=function(e){var f,nbItems,selected_values;if(e==null){return}selected_values=[];select.find('option').each(function(){if(!$(this).is(":selected")){return $(this).remove()}else{return selected_values.push($(this).val()+"-"+$(this).text())}});select.find('optgroup:empty').each(function(){return $(this).remove()});f=j!=null?j(e,g):e;nbItems=0;$.each(f,function(i,c){var d,text,value;nbItems++;if(c.group){d=select.find("optgroup[label='"+c.text+"']");if(!d.size()){d=$("<optgroup />")}d.attr('label',c.text).appendTo(select);return $.each(c.items,function(i,a){var b,value;if(typeof a==="string"){value=i;b=a}else{value=a.value;b=a.text}if($.inArray(value+"-"+b,selected_values)===-1){return $("<option />").attr('value',value).html(b).appendTo(d)}})}else{if(typeof c==="string"){value=i;text=c}else{value=c.value;text=c.text}if($.inArray(value+"-"+text,selected_values)===-1){return $("<option />").attr('value',value).html(text).appendTo(select)}}});if(nbItems){select.trigger("chosen:updated")}else{select.data().chosen.no_results_clear();select.data().chosen.no_results(g.val())}if(h.success!=null){h.success(e)}return g.val(untrimmed_val)};return this.timer=setTimeout(function(){if(l){l.abort()}return l=$.ajax(options)},options.afterTypeDelay)})})}})(jQuery)}).call(this);